<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.kosa.mini.member.MemberDAO"><!-- namespace 별칭 써 줄임말 만들기 -->
	<sql id="search">
		<if test="searchValue != null and searchValue != ''">
			AND ID = #{searchValue}
		</if>
	</sql>
	<sql id="field1">
		<choose>
			<when test="password == null">
				ID
			</when>
			<otherwise>
				ID, PASSWORD, LOCKYN, LOGINFAILURE, BOARDAUTH
			</otherwise>			
		</choose>
	</sql>
	<select id="login" resultType="org.kosa.mini.member.MemberVO">
		SELECT 
			<include refid = "field1"/>
		FROM 
			TB_MEMBER
		WHERE 
			ID = #{id} AND DELETEYN = 'N'
	</select>
	<select id="getMemberList" resultType="org.kosa.mini.member.MemberVO">
		SELECT *	
		FROM(SELECT ROWNUM RNUM , M.*
			FROM
				(SELECT 
					MEMBERNO, ID, NAME, PHONENUMBER, POSTCODE, ADDRESS, DETAILADDRESS, CREATEDAT, LOCKYN, BOARDAUTH
				FROM 
					TB_MEMBER
				WHERE 
					DELETEYN = 'N' <include refid = "search"/>) M
			WHERE ROWNUM BETWEEN 1 AND #{end}) R
		WHERE RNUM BETWEEN #{start} AND #{end}
		ORDER BY MEMBERNO DESC
	</select>
	<update id="updateFailure">
		UPDATE 
			TB_MEMBER
		SET 
			LOGINFAILURE = LOGINFAILURE + 1
		WHERE 
			ID = #{id} AND LOCKYN = 'N' AND LOGINFAILURE &lt; 5
	</update>
	<update id="updateLockYn">
		UPDATE 
			TB_MEMBER
		SET 
			LOCKYN = 'Y'
		WHERE 
			ID = #{id} AND DELETEYN = 'N' AND LOCKYN = 'N'
	</update>
	<update id="lockYn">
		UPDATE
			TB_MEMBER
		SET
			LOCKYN = #{lockYn}
		WHERE
			MEMBERNO=#{memberNo} AND DELETEYN = 'N'
	</update>
	<select id="getTotalCount" resultType="int">
		SELECT 
			COUNT(*)
		FROM 
			TB_MEMBER
		WHERE 
			DELETEYN = 'N'
			<include refid="search"/>
	</select>
</mapper>

